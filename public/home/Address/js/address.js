define("member:app/script/page/address",function(e){e("handlebars-helper.js");var a,t,l,d=e("common:lib/jquery/jquery-1.11.3"),s=e("config-url.js"),i=e("member:app/script/handlebars"),n=e("cookie.js"),r=e("validate.js"),c=e("form-beautify.js"),o=e("rollingTo.js"),u=e("isToken.js"),v=1,m=e("dialog.js"),p=new m("alert"),f=JSON.parse(decodeURIComponent(n.getCookie("MEIZUSTORESESSIONVAL"))).uid,h=function(e,a,t,l,s){d.ajax({url:"http://store.meizu.com/member/address/get_child_area",type:"post",dataType:"json",data:{code:s},success:function(e){if(200==e.code){var d='<option value="" style="display:none"></option>\r\n{{#each data}}\r\n<option value="{{code}}" data-zipCode="{{zipCode}}">{{name}}</option>\r\n{{/each}}';a.html("").html(i.compile(d)(e)),c.select.init(t,l)}}})},I={city:function(e){var a=d("#mzuiSelect-cityId .mzui_select_item"),t=d(".cityId"),l=d(".mzui_select_city"),s=d("#mzuiSelect-cityId ul");h(a,t,l,s,e)},area:function(e){var a=d("#mzuiSelect-areaId .mzui_select_item"),t=d(".areaId"),l=d(".mzui_select_area");element=d("#mzuiSelect-areaId ul"),h(a,t,l,element,e)},town:function(e){var a=d("#mzuiSelect-townId .mzui_select_item"),t=d(".townId"),l=d(".mzui_select_town");element=d("#mzuiSelect-townId ul"),h(a,t,l,element,e)}};d("#mzuiSelect-provinceId .mzui_select_item").click(function(){var e=d(this).attr("data-value");I.city(e)}),d(document).on("click","#mzuiSelect-cityId .mzui_select_item",function(){var e=d(this).attr("data-value");I.area(e)}),d(document).on("click","#mzuiSelect-areaId .mzui_select_item",function(){var e=d(this).attr("data-value");I.town(e)});var y=function(e){var s=d("#default")[0].checked===!0?1:0;return thirdAddress=d(".area").val()==d(".town").val()?d(".area").val():d(".area").val()+d(".town").val(),_addressData={address:d("#detailAddress").val(),completeAddress:d(".province").val()+d(".city").val()+thirdAddress+d("#detailAddress").val(),areaId:""==d(".areaId").val()?t:d(".areaId").val(),cityId:""==d(".cityId").val()?a:d(".cityId").val(),id:1===v?"":e,isDefault:s,provinceId:d(".provinceId").val(),receiver:d("#name").val(),telNumber:d("#phone").val(),townId:""==d(".townId").val()?l:d(".townId").val(),userId:f,zipCode:d("#mzuiSelect-areaId").find(".mzui_select_item_selected").attr("data-zipcode")},JSON.stringify(_addressData)},S=function(){u.get({url:s+"/vip/address/"+f,successCallback:function(e){sHtml='{{#each data}}\r\n<li>\r\n    <input class="addressId" type="hidden" value="{{id}}">\r\n    <input class="isOld" type="hidden" value="{{isOld}}">\r\n\r\n    <span class="center w15">{{receiver}}</span>\r\n    <span class="completeAddress center w35">{{completeAddress}}</span>\r\n    <span class="center w25">{{telNumber}}</span>\r\n    <span class="center w10">\r\n      {{#equal isOld 1}}\r\n      <a class="edit" href="javascript:;">升级</a>\r\n      {{/equal}}\r\n      {{#equal isOld 0}}\r\n      <a class="edit" href="javascript:;">修改</a>\r\n      {{/equal}}\r\n      <a class="delete" href="javascript:;">删除</a>\r\n    </span>\r\n    <span class="left w15">\r\n      {{#equal isOld 1}}\r\n      <a class="edit uploadBtn" href="javascript:;">立即升级</a>\r\n      {{/equal}}\r\n      {{#equal isOld 0}}\r\n        {{#equal isDefault 1}}\r\n        <i class="iconfont icon-default"></i>\r\n        <i class="defaultAddress">默认地址</i>\r\n        {{/equal}}\r\n        {{#equal isDefault 0}}\r\n        <a class="beDefault hide" href="javascript:;">设为默认</a>\r\n        {{/equal}}\r\n      {{/equal}}\r\n    </span>\r\n</li>\r\n{{/each}}',d("#tableList").html(i.compile(sHtml)(e));var n=d("#tableList li"),r=n.length;n.hover(function(){d(this).addClass("active"),d(this).find(".beDefault").removeClass("hide")},function(){d(this).removeClass("active"),d(this).find(".beDefault").addClass("hide")});var c=d(".isOld");isOldArr=Array.prototype.slice.call(c),num=0;for(var p=0,h=isOldArr.length;h>p;p++)num+=isOldArr[p].value;num>0?d(".upload").removeClass("hide"):d(".upload").addClass("hide"),d(".already").text(r),d(".settle").text(0>=10-r?0:10-r),d(".delete").click(function(){var e=new m("confirm"),a=d(this).parent().parent().find(".addressId").val();e.run({titStr:"",contStr:"确定要删除地址？",confirmFunc:function(){u.post({url:s+"/vip/address/"+f+"/delete/"+a,successCallback:function(){S()}})}})}),d(".beDefault").click(function(){var e=d(this).parent().parent().find(".addressId").val();u.post({url:s+"/vip/address/default/"+f+"/"+e,successCallback:function(){S()}})}),d(".edit").click(function(){v=0,d("#valid-form")[0].reset(),d("#mzuiSelect-cityId ul").html(""),d("#mzuiSelect-areaId ul").html(""),d("#mzuiSelect-townId ul").html("");{var e=d(this);new o({oFinish:d(".rollit"),varsSpeed:300,fnAdditional:function(){var i=e.parent().parent().find(".addressId").val();d(".rollit").text("修改收货地址"),u.get({url:s+"/vip/address/"+f+"/"+i,successCallback:function(e){var s=e.data;d("#valid-form .addressId").val(s.id),d("#name").val(s.receiver),d("#phone").val(s.telNumber),d("#detailAddress").val(s.address),d("#default")[0].checked=1==s.isDefault?!0:!1,1!=s.isOld&&(I.city(s.provinceId),I.area(s.cityId),I.town(s.areaId),d(".province").val(s.province),d(".provinceId").val(s.provinceId),d(".city").val(s.city),d(".area").val(s.area),d(".town").val(s.town),a=s.cityId,t=s.areaId,l=s.townId)}})}})}})}})};S(),d(".varify").on({focus:function(){d(this).addClass("active")},blur:function(){d(this).removeClass("active")}}),d("#name").on("keyup blur",function(){r.addressName(d("#name"))}),d("#phone").on("keyup blur",function(){r.addressPhone(d("#phone"))}),d(".provinceId").on("change",function(){d("#mzuiSelect-areaId ul,#mzuiSelect-townId ul").html(""),d(".city,.area,.town").val(""),r.addressSelect(d(".province"),"请选择所在省/直辖市")}),d(".cityId").on("change",function(){d("#mzuiSelect-townId ul").html(""),d(".area,.town").val(""),r.addressSelect(d(".city"),"请选择所在城市")}),d(".areaId").on("change",function(){d(".town").val(""),r.addressSelect(d(".area"),"请选择所在区/县")}),d(".townId").on("change",function(){r.addressSelect(d(".town"),"请选择所在乡镇/街道")}),d("#detailAddress").on("keyup blur",function(){r.addressDetail(d("#detailAddress"))}),d(".saveAddress").click(function(){var e=r.addressName(d("#name"))===!0?0:1,i=r.addressPhone(d("#phone"))===!0?0:1,n=r.addressSelect(d(".province"),"请选择所在省/直辖市")===!0?0:1,c=r.addressSelect(d(".city"),"请选择所在城市")===!0?0:1,o=r.addressSelect(d(".area"),"请选择所在区/县")===!0?0:1,m=r.addressSelect(d(".town"),"请选择所在乡镇/街道")===!0?0:1,f=r.addressDetail(d("#detailAddress"))===!0?0:1,h=e+i+n+c+o+m+f;if(0===h){var I=parseInt(d(".already").text()),z=10,w=1===v?s+"/vip/address/add":s+"/vip/address/update";if(I>=z&&1==v)return void p.run("您添加的地址数量已超过上限，请管理您的地址！");u.post({url:w,datas:y(d("#valid-form .addressId").val()),beforeSend:function(){d(".saveAddress").prop("disabled",!0).addClass("disabled")},successCallback:function(){d(".saveAddress").prop("disabled",!1).removeClass("disabled"),d(".rollit").text("新增收货地址"),S(),d("#valid-form")[0].reset(),v=1,a=null,t=null,l=null,d("#mzuiSelect-cityId ul").html(""),d("#mzuiSelect-areaId ul").html(""),d("#mzuiSelect-townId ul").html("")}})}})});