define("member:app/script/page/order",function(require,exports,module){function loadDataList(){if(isSupportHistory()){category&&currentPage?loadObj(_dataFn(category).allUrl,_dataFn(category).tpl,callback,currentPage):!category&&currentPage?loadObj(_dataFn(-1).allUrl,_dataFn(-1).tpl,callback,currentPage):category&&!currentPage?loadObj(_dataFn(category).allUrl,_dataFn(category).tpl,callback):category||currentPage||loadObj(_dataFn(category).allUrl,_dataFn(category).tpl,callback);for(var r=$(".type-tab-btn a"),e=Array.prototype.slice.call(r),a=0,n=e.length;n>a;a++)$(e[a]).attr("data-type")==category&&($(".type-tab-btn a").removeClass("active"),$(e[a]).addClass("active"))}else loadObj(_dataFn(category).allUrl,_dataFn(category).tpl,callback)}function isSupportHistory(){return!(!window.history||!history.pushState)}require("handlebars-helper.js");var $=require("common:lib/jquery/jquery-1.11.3"),Cookie=require("cookie.js"),configUrl=require("config-url.js"),loadData=require("load-data.js"),parameter=require("href-parameter.js"),opreatFn=require("member:app/script/page/orderOpreat"),ajaxAgency=require("isToken.js"),dailog=require("dialog.js"),Dailog=new dailog("alert"),category=parameter.get("type")||-1,currentPage=parameter.get("current")||1,userId=JSON.parse(decodeURIComponent(Cookie.getCookie("MEIZUSTORESESSIONVAL"))).uid,pageId=$("#pageId").val(),loadObj=function(r,e,a,n){new loadData({url:r,container:"#tableList",tpl:e,noListStr:"您暂无此类订单，赶快去下单吧！",sendData:{pageSize:6,current:n},pageType:"default",tplFn:null,callback:a})},orderStatus=-1,orderSn,_dataFn=function(r){return _data={allUrl:configUrl+"/vip/order/orders/"+userId+"/"+r,addressUrl:configUrl+"/vip/order/address/"+userId+"/"+orderSn,tpl:'<table class="orderItem">\r\n    {{#each data.resultList}}\r\n    {{#if old}}\r\n    <tr class="trHead">\r\n        <td colspan="5" class="title">\r\n            下单时间：<span class="time">{{transFormatDateAll createTime}}</span>订单号：<span class="orderNumber">{{orderSn}}</span>\r\n        </td>\r\n    </tr>\r\n    <tr class="list-box b-l b-r b-b">\r\n        <td class="list b-r">\r\n        {{#each childOrders}}\r\n            <div class="item clearfix">\r\n                {{{toSeeProductDetail ../old insuranceOrder itemNumber}}}\r\n                <img src="{{imgUrl}}"></a>\r\n                <div class="describe f-fl">\r\n                    <div class="vertic">\r\n                        <span class="clearfix">\r\n                            {{{toSeeProductDetail ../old insuranceOrder itemNumber}}}\r\n                            {{itemName}}</a>\r\n                            <i class="f-fr">￥{{price}} ×{{quantity}}</i>\r\n                        </span>\r\n                        {{#if insurance}}\r\n                        <span class="clearfix">\r\n                            <i class="f-fl nameWidth">{{insurance.name}}</i>\r\n                            <i class="f-fr">￥{{insurance.price}} ×{{insurance.num}}</i>\r\n                        </span>\r\n                        {{/if}}\r\n                    </div>\r\n                </div>\r\n                <div class="seeDeliverBox">\r\n                    {{{isInsuranceOrder insuranceOrder ../status ../old expressStatus}}}\r\n                    {{!是否是老商品}}\r\n                    <input class="isOldProduct" type="hidden" value="{{../old}}">\r\n                    <input class="orderSn" type="hidden" value="{{../orderSn}}">\r\n                    <input class="orderSnSon" type="hidden" value="{{orderSn}}">\r\n                    <div class="content"></div>\r\n                </div> \r\n            </div>\r\n        {{/each}}\r\n        </td>  \r\n        <td class="b-r w125 center price">\r\n            <div class="priceDiv">\r\n                ￥ {{payPrice}}\r\n                {{{repoOrder repoMoney}}}\r\n                {{{mOrder type}}}\r\n            </div>\r\n        </td>  \r\n        <td class="b-r w125 center state">\r\n            <div class="stateDiv">\r\n                {{orderStatus status}}<br>{{isRefund inServiceStatus}}\r\n            </div>\r\n        </td> \r\n        <td class="w125 center opreat">\r\n            <ul>\r\n                {{!是否是老的商品}}\r\n                <input class="_isOld" type="hidden" value="{{old}}">\r\n                {{!待付款}}\r\n                {{#equal status 0}}\r\n                <li class="goPay">{{{goPay orderSn old}}}</li>\r\n                <li class="cancel">取消订单</li>\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!待发货}}\r\n                {{#equal status 1}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{{applyFn inServiceStatus status}}}\r\n                {{/equal}}\r\n                {{!已发货}}\r\n                {{#equal status 2}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!已取消}}\r\n                {{#equal status 3}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!交易成功}}\r\n                {{#equal status 4}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!退款申请中}}\r\n                {{#equal status 5}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!退款申请中}}\r\n                {{#equal status 6}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!已退款}}\r\n                {{#equal status 7}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!退款关闭}}\r\n                {{#equal status 8}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!意外保订单}}\r\n                {{#equal status 9}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{{applyFn inServiceStatus status}}}\r\n                {{/equal}}\r\n                {{!退款申请中}}\r\n                {{#equal status 10}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!已付款}}\r\n                {{#equal status 11}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{{applyFn inServiceStatus status}}}\r\n                {{/equal}}\r\n                {{!付款待核实}}\r\n                {{#equal status 13}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!已取机}}\r\n                {{#equal status 14}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!已验证}}\r\n                {{#equal status 15}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!返款申请中}}\r\n                {{#equal status 16}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!已返款}}\r\n                {{#equal status 17}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!取机中}}\r\n                {{#equal status 18}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!待取机}}\r\n                {{#equal status 19}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!部分发货}}\r\n                {{#equal status 22}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n            </ul>\r\n        </td> \r\n    </tr>\r\n    <tr class="empty">\r\n        <td></td>\r\n    </tr>\r\n    {{else}}\r\n    <tr class="trHead">\r\n        <td colspan="5" class="title clearfix">\r\n            <div class="f-fl">下单时间：<span class="time">{{transFormatDateAll createTime}}</span>订单号：<span class="orderNumber">{{orderSn}}</span>\r\n            </div>\r\n            <span class="brand f-fr">\r\n                {{brandName}}\r\n                <i class="service">由“{{brandName}}”负责发货，并提供售后服务</i>\r\n                <i class="icon"></i>\r\n            </span>\r\n        </td>\r\n      </tr>\r\n    <tr class="list-box b-l b-r b-b">\r\n        <td class="list b-r">\r\n            {{#each childOrders}}\r\n            <div class="item clearfix">\r\n                {{{toSeeProductDetail ../old insuranceOrder itemNumber}}}\r\n                <img src="{{imgUrl}}"></a>\r\n                <div class="describe f-fl">\r\n                    <div class="vertic clearfix">\r\n                        <span class="clearfix">\r\n                            {{{toSeeProductDetail ../old insuranceOrder itemNumber}}}\r\n                            {{itemName}}</a>\r\n                            <i class="f-fr">￥{{price}} ×{{quantity}}</i>\r\n                        </span>\r\n                        {{#if insurance}}\r\n                        <span class="clearfix">\r\n                            <i class="f-fl nameWidth">{{insurance.name}}</i>\r\n                            <i class="f-fr">￥{{insurance.price}} ×{{insurance.num}}</i>\r\n                        </span>\r\n                        {{/if}}\r\n                    </div>\r\n                </div> \r\n                <div class="seeDeliverBox">\r\n                    {{{isInsuranceOrder insuranceOrder ../status ../old expressStatus}}}\r\n                    {{!是否是老商品}}\r\n                    <input class="isOldProduct" type="hidden" value="{{../old}}">\r\n                    <input class="orderSn" type="hidden" value="{{../orderSn}}">\r\n                    <input class="orderSnSon" type="hidden" value="{{orderSn}}">\r\n                    <div class="content"></div>\r\n                </div>\r\n            </div>\r\n            {{/each}}\r\n        </td>   \r\n        <td class="b-r w125 center price">  \r\n            <div class="priceDiv">\r\n                ￥ {{payPrice}}\r\n                {{{repoOrder repoMoney}}}\r\n                {{{mOrder type}}}\r\n            </div>\r\n        </td>  \r\n        <td class="b-r w125 center state">\r\n            <div class="stateDiv">\r\n                {{orderStatus status}}<br>{{isRefund inServiceStatus}}\r\n            </div>\r\n        </td> \r\n        <td class="w125 center opreat">\r\n            <ul>\r\n                {{!待付款}}\r\n                {{#equal status 0}}\r\n                <li class="goPay">{{{goPay orderSn old}}}</li>\r\n                <li class="cancel">取消订单</li>\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!待发货}}\r\n                {{#equal status 1}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{{applyFn inServiceStatus status}}}\r\n                {{/equal}}\r\n                {{!已发货}}\r\n                {{#equal status 2}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                <li>{{{receiveFn childOrders}}}</li>\r\n                {{/equal}}\r\n                {{!已取消}}\r\n                {{#equal status 3}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!交易成功}}\r\n                {{#equal status 4}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!退款申请中}}\r\n                {{#equal status 5}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!退款申请中}}\r\n                {{#equal status 6}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!已退款}}\r\n                {{#equal status 7}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!退款关闭}}\r\n                {{#equal status 8}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!意外保订单}}\r\n                {{#equal status 9}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{{applyFn inServiceStatus status}}}\r\n                {{/equal}}\r\n                {{!退款申请中}}\r\n                {{#equal status 10}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!已付款}}\r\n                {{#equal status 11}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{{applyFn inServiceStatus status}}}\r\n                {{/equal}}\r\n                {{!付款待核实}}\r\n                {{#equal status 13}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!已取机}}\r\n                {{#equal status 14}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!已验证}}\r\n                {{#equal status 15}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!返款申请中}}\r\n                {{#equal status 16}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!已返款}}\r\n                {{#equal status 17}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!取机中}}\r\n                {{#equal status 18}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n                {{!待取机}}\r\n                {{#equal status 19}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n                {{/equal}}\r\n            </ul>\r\n        </td> \r\n    </tr>\r\n    <tr class="empty">\r\n        <td></td>\r\n    </tr>\r\n    {{/if}}\r\n    {{/each}}\r\n</table>\r\n'}},waitingPay=function(){ajaxAgency.get({url:configUrl+"/vip/order/statusnum/"+userId,successCallback:function(r){var e=0===r.data.unPayNum?"":r.data.unPayNum;$("._actAmount").text(e)}})},callback=function(){$(".brand").hover(function(){var r=$(this),e=r.find(".service"),a=r.find(".icon");e.show(),a.show();var n=(r.width(),a.width()),l=e.width(),t=l+n+25,s=n+4;e.css("margin-left","-"+t+"px"),a.css("margin-left","-"+s+"px")},function(){$(".service").hide(),$(".icon").hide()}),waitingPay(),$(".seeDeliverBox").hover(function(){var r=$(this),e=r.find(".isOldProduct").val(),a=1==e?r.find(".orderSn").val():r.find(".orderSnSon").val();opreatFn.seeDeliver(r,e,a,pageId,userId)},function(){$(".content").hide()}),$(".cancel").click(function(){var _this=$(this),isOld=eval(_this.parent().find("._isOld").val())===!0?1:0,orderSn=_this.parents(".list-box").find(".orderSn").val();opreatFn.cancle(_this,isOld,orderSn,pageId,function(){orderStatus=$(".type-tab-btn").find(".active").attr("data-type"),loadObj(_data.allUrl,_data.tpl,callback)})}),$(".apllyBack").click(function(){var _this=$(this),isOld=eval(_this.parent().find("._isOld").val())===!0?1:0,orderSn=_this.parents(".list-box").find(".orderSn").val();opreatFn.apllyBack(_this,isOld,orderSn,pageId,function(){orderStatus=$(".type-tab-btn").find(".active").attr("data-type"),loadObj(_data.allUrl,_data.tpl,callback)})}),$(".receive").click(function(){var r=$(this),e=r.parents(".list-box").find(".orderSn").val();opreatFn.receiveFn(e,pageId,function(){orderStatus=$(".type-tab-btn").find(".active").attr("data-type"),loadObj(_data.allUrl,_data.tpl,callback)})})};loadDataList(),isSupportHistory()&&$(window).on("popstate",function(){category=parameter.get("type")||-1,currentPage=parameter.get("current")||1,loadDataList()}),$(".type-tab-btn a").click(function(){orderStatus=$(this).attr("data-type"),isSupportHistory()&&history.pushState({title:document.title},document.title,location.href.split("?")[0]+"?type="+orderStatus),$(this).addClass("active").siblings().removeClass("active"),loadObj(_dataFn(orderStatus).allUrl,_dataFn(orderStatus).tpl,callback)})});